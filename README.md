# 抖音PC端视频放大工具

一个基于 Tampermonkey 的用户脚本，用于在抖音PC端页面中提供视频局部放大功能。

## 功能特性

### 🎬 视频放大功能
- **支持所有视频**：可以对页面中的任何视频进行放大，包括直播视频
- **可调节放大倍数**：支持 1.0x - 3.0x 的放大倍数，默认 1.0x
- **视频拖拽定位**：放大后的视频支持鼠标拖拽，可以调整视频显示区域
  - 鼠标悬停显示手形图标（grab）
  - 拖拽时显示抓取状态（grabbing）
  - 类似WPS文档的拖拽体验
  - **直播视频支持**：在直播视频中也能正常显示手形光标并支持拖拽
- **保持居中显示**：放大后的视频保持居中，不影响页面其他元素
- **暂停时保持放大**：视频暂停时放大效果不会消失，方便仔细查看画面内容

### 🎛️ 控制面板
- **圆形按钮**：吸附在屏幕右上角的圆形按钮
- **F键显示/隐藏**：按F键可以显示/隐藏控制按钮
- **点击切换**：点击按钮显示/隐藏完整控制面板

## 安装方法

### 1. 安装 Tampermonkey

首先需要安装 Tampermonkey 浏览器扩展：

- **Chrome**: [Chrome Web Store](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
- **Edge**: [Edge Add-ons](https://microsoftedge.microsoft.com/addons/detail/tampermonkey/iikmkjmpaadaobahmlepeloendndfphd)
- **Firefox**: [Firefox Add-ons](https://addons.mozilla.org/firefox/addon/tampermonkey/)
- **Safari**: [Safari Extensions](https://apps.apple.com/app/tampermonkey/id1482490089)

### 2. 安装脚本

1. 打开 Tampermonkey 管理面板
2. 点击"添加新脚本"
3. 复制 `抖音pc端视频放大工具.user.js` 文件的全部内容
4. 粘贴到编辑器中
5. 保存脚本（Ctrl+S 或 Cmd+S）

### 3. 使用脚本

1. 访问 [抖音PC端](https://www.douyin.com)
2. 打开任意视频页面
3. 按 `F` 键显示控制按钮（屏幕右上角的⚙图标）
4. 点击按钮打开控制面板进行设置

## 使用说明

### 基本操作

1. **显示/隐藏控制按钮**
   - 按快捷键 `F` 键
   - 首次使用时，需按F键显示控制按钮

2. **打开控制面板**
   - 点击屏幕右上角的圆形按钮

3. **调整放大倍数**
   - 在控制面板中拖动"放大倍数"滑块
   - 范围：1.0x - 3.0x

4. **启用/禁用视频放大**
   - 勾选/取消"启用视频放大"选项
   - **默认状态**：视频放大功能默认不启用
   - **设置重置**：每次加载脚本或刷新页面时，所有设置都会重置为默认状态

5. **拖拽视频位置**
   - 将鼠标悬停在放大后的视频上
   - 鼠标变为手形时，按住左键拖拽
   - 可以调整视频的显示区域

### 快捷键

- `F` 键：显示/隐藏控制按钮

## 技术实现

### 核心模块

1. **视频检测模块** (`VideoDetector`)
   - 使用 `MutationObserver` 监听DOM变化
   - 自动定位页面中的 video 元素

2. **视频放大模块** (`VideoEnlarger`)
   - 使用 CSS `transform: scale()` 实现缩放
   - 使用 `transform: translate()` 实现拖拽
   - 支持动态调整放大倍数
   - **样式保护机制**：使用 MutationObserver 监听 style 属性变化，防止抖音暂停时清除放大效果
   - **暂停事件监听**：监听视频 pause 事件，确保暂停时保持放大状态

3. **控制面板模块** (`ControlPanel`)
   - 浮动UI面板
   - 快捷键支持

4. **页面适配模块** (`PageAdapter`)
   - 检测页面类型，区分直播和普通视频
   - 处理SPA路由切换

## 浏览器兼容性

- ✅ 所有现代浏览器（Chrome、Edge、Firefox、Safari）

## 注意事项

1. **性能影响**
   - 视频放大使用CSS transform，性能影响较小

2. **直播页面**
   - 直播页面现在支持视频放大和拖拽功能
   - 控制按钮会正常显示

## 常见问题

### Q: 控制面板不显示？
A: 
1. 检查 Tampermonkey 是否正常运行
2. 确认脚本已启用
3. 尝试按F键显示控制按钮
4. 检查浏览器控制台是否有错误信息

### Q: 视频放大后无法拖拽？
A: 
1. 确认视频放大功能已启用
2. 尝试刷新页面

## 更新日志

### v0.0.5
- ✅ 修复直播视频拖动功能
- ✅ 将事件监听器从视频元素移动到视频容器，确保覆盖层不阻止事件触发
- ✅ 在容器上设置光标样式，确保直播视频覆盖层显示手形光标
- ✅ 优化事件监听器管理，避免内存泄漏
- ✅ 直播视频现在支持完整的拖拽功能，与普通视频体验一致

### v0.0.4
- ✅ 完全移除本地配置保存功能
- ✅ 每次加载脚本时重置为默认状态
- ✅ 视频放大功能默认不启用
- ✅ 按钮位置不再保存，每次重置为默认位置
- ✅ 移除所有 localStorage 操作

### v0.0.3
- ✅ 修改视频放大功能默认状态为不启用

### v0.0.2
- ✅ 修复暂停时视频放大效果消失的问题
- ✅ 添加样式保护机制，自动检测并恢复被清除的放大效果
- ✅ 添加暂停事件监听，确保暂停时保持放大状态
- ✅ 优化事件监听器管理，修复控制面板开关功能
- ✅ 优化MutationObserver监听，减少不必要的回调
- ✅ 修复事件监听器泄漏问题
- ✅ 优化定时器，延长检查间隔
- ✅ 支持所有视频类型，不再局限于竖屏视频

### v0.0.1
- ✅ 初始版本
- ✅ 视频放大功能
- ✅ 控制面板
- ✅ 视频拖拽功能
- ✅ 页面适配

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 作者

Created with ❤️ for better Douyin viewing experience